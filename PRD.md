## PRD.md — 360Me Couple Insight (*If I were you → 부부 확장*)

**요약 (3–5줄)**
이 서비스는 “내가 너라면” 검사(1단계)와 배우자 자기·상대 인식 비교(2단계), 부부 심층 설문(3단계)을 결합해 관점 차(Δ), 반복 갈등 패턴, 수리(Repair) 행동을 도출합니다. 결과는 하위척도 점수(8축), Δ 히트맵, Top‑3 이슈·실습 안내로 제공되며, 위기 신호는 안전 프로토콜로 우회합니다. 모든 계산과 인사이트는 **결정 패킷(decision_packet)**으로 봉인되어 재현성과 책임 추적이 가능합니다.

```yaml
---
version: "1.0"
date: "2025-09-19"
product: "360Me Couple Insight"
domains: ["backend", "frontend", "data", "safety"]
owner: "PM/Forensic Eng: 이지율"
source_of_truth: "PRD.md"
use_browsing: false
---
```

### 0) Assumptions (가정)

- 대상: 법적·사실혼 포함 커플(성별 불문), 한국어 우선.
- 데이터 입력: 각 파트너가 SELF / GUESS 2열 응답, 0–4 척도(일부 0–10).
- 1단계: “내가 너라면” 기존 데이터(타인의 남편 인식) 재사용. 공개는 k≥3일 때만.
- 보안/프라이버시: 결과는 요약값 기준. 민감 텍스트는 암호화 저장, 링크 공유는 noindex.
- 스택(요약): BE=FastAPI(Python), FE=React+TS+Vite, DB=PostgreSQL, 캐시=Redis.

---

### 1) 비전·문제 정의·타깃

- 비전: 부부가 오해→이해→합의로 이동하는 “안전한 대화 컨테이너” 제공.
- 문제: 추궁–회피, 마음읽기, 생활 운영 불공정 등 패턴화된 갈등이 반복.
- 타깃: 20–40대 커플(연애·신혼·육아기). 셀프 가이드+상담 연계 모두 고려.

---

### 2) 범위 (Scope)

- **In:** 3단계 입력 플로우, 채점/Δ/플래그, Top‑3 이슈+코칭 카드, 결과 시각화(레이더, Δ 히트맵, 시나리오), 안전 경로(상담/기관 안내), PDF/링크 보관(비공개).
- **Out (1차):** 결제, 전문 상담 매칭, 멀티 커플 비교, 다국어, 모바일 앱.

---

### 3) 사용자 시나리오

1. **A(아내)**가 1단계 “남편에 대한 타인의 시선” 요약 열람(k≥3).
2. **A/B**가 동일 설문을 각자 작성(SELF/GUESS).
3. 시스템은 하위척도 점수 + Δ 계산 → Top‑3 이슈 카드 생성.
4. 시나리오 실습(타임아웃 합의·사실확인 질문 등)과 이번 주 행동 1가지 도출.
5. 결과를 공유 금지 기본값으로 보관(링크/PDF). 위기 신호는 안전 안내.

---

### 4) 기능 요구 (Functional Requirements)

| ID      | 요약                 | 설명                                             | 의존성  | 위험   | 수락 기준 (요약)                               |
|---------|----------------------|--------------------------------------------------|--------|--------|-----------------------------------------------|
| R-101   | 3단계 플로우         | 1)타인지표 요약 → 2)SELF/GUESS 입력 → 3)부부 설문 | Auth, DB | 이탈   | 단계별 저장/복구, 페이지 리로드에도 진행률 복원 |
| R-102   | SELF/GUESS 이중 입력 | 각 항목 2칸(나/배우자 추정) 수집                 | R-101 | 혼동   | 0–4 라디오, 키보드 가능, 접근성 레이블         |
| R-103   | 채점/정규화          | 역채점 포함 하위척도 평균(0–4), SF1은 별도(0–10) | R-102 | 계산오류 | 샘플 대비 편차 ≤1e-6, 경계값 테스트 통과        |
| R-104   | Δ 계산               | ΔAᵢ = A.GUESS - B.SELF, ΔBᵢ = B.GUESS - A.SELF   | R-103 | 해석오류 | 하위척도 평균 Δ 출력, 문항 상위 Δ Top-5        |
| R-105   | 플래그 판정          | 안전/패턴/정서/인지/운영/친밀/희망 룰 적용       | R-103 | 과잉경보 | 샘플 규칙표와 일치, 민감 임계 튜닝 가능         |
| R-106   | 인사이트 카드        | Top‑3 이슈 요약 + 실습/과제 버튼                 | R-105 | 과장   | 용어 가이드 준수, 단정 표현 금지               |
| R-107   | 시각화               | 레이더(8축)/Δ 히트맵/시나리오 정답 예시          | R-103 | 과밀   | 360/768/1024 반응형, 30fps 이상                |
| R-108   | 안전 경로            | 폭력·강압 등 위험 문항 플래그 시 안내            | R-105 | 누락   | 안전 안내 상시 노출, 외부 연계 링크            |
| R-109   | k-익명 공개          | 1단계 집계 k<3 비공개                            | R-101 | 재식별 | k 상태 뱃지·도달 가이드, 비공개 잠금          |
| R-110   | 결과 보관            | 링크/PDF 저장(noindex)                           | R-107 | 유출   | 링크 만료/취소, 토큰화                         |
| R-111   | 표준 오류            | RFC 9457 Problem Details                          | 공통   | 누락   | 모든 4xx/5xx 스키마 준수                       |
| R-112   | 요청 ID/관측         | X-Request-ID, OTel 트레이스 전파                 | 공통   | 누락   | 로그-트레이스 조인 성공률 ≥99%                |
| R-113   | 결정 패킷            | 입력·버전·출력 해시로 결과 봉인                  | R-103/104 | 위변조 | packet 해시 저장 + 다운로드 가능             |
| R-114   | 알림/리마인드        | 중단 세션·결과 리마인드(옵트인)                  | 공통   | 스팸   | 옵트아웃, 1일 1회 상한                         |

---

### 5) 비기능 요구 (NFR: 수치 + 검증)

- 가용성: 월 99.9%
- 백엔드: 핵심 API 평균 <500ms, P95 <1s, 오류율 <1% (k6 + APM)
- 프런트(Web Vitals): LCP ≤2.5s, INP ≤200ms, CLS ≤0.1 (Lab + Field)
- 보안/프라이버시: TLS, TDE, 결과 noindex, 토큰 링크 만료, PII 최소화
- 접근성: WCAG 2.2 AA (키보드·대비·포커스·모션 감소)
- 관측성: 요청 ID 100%, 오류 트레이스 100% 샘플링, 정상 ≥20%

---

### 6) 채점·해석 규칙 (요약)

- 하위척도(8축): CS/EA/CB/PD/RP/LF/IN/SF — 평균 0–4(긍정 직점수, CB1–CB4·PD1–PD2 역채점)
- Δ 등급: Δ <0.8(양호) / 0.8–1.6(부분 불일치) / ≥1.6(고위험 오해)
- 플래그 예시: CS2 ≤2 또는 IN4 ≤2 → 안전/존중 즉시 개입, PD1 ≥3 & PD3 ≥3 → 추궁–회피 교육 등
- 시나리오: S2는 타임아웃(B) 선택률과 설명 문구를 학습 카드로 연결

---

### 7) 결과 산출물

- 대시보드: 하위척도 레이더(자기/배우자 평균), Δ 히트맵, Top‑3 이슈
- 코칭 카드: “3초 규칙”, “나-전달”, “20분 타임아웃 합의”, “거절 후 대체 제안” 등
- 주간 과제: “사실확인 질문 1회”, “하루 1감사”, “타임아웃 1회 실습”

---

### 8) 릴리즈 수락 기준

1. E2E(5 시나리오) 통과: 입력 → 채점 → Δ → 플래그 → 결과/과제
2. Δ·하위척도 계산 스냅샷 테스트 올그린(역채점 포함)
3. RFC 9457 오류/요청 ID/OTel 조인 검증
4. k<3 잠금/안전 안내 동작 확인
5. LCP/INP/CLS 목표 충족 (랩 + 필드)

---

### 9) 리스크·완화 / 가정·미결

- 리스크: 민감 주제 노출 → 안전 안내 상시·쉼표 경로 제공
- 리스크: Δ 오해 과장 → 단정 표현 금지·수치/표본/시점 병기
- 가정: 초기 DAU <1k, 상담 연계는 링크 안내 수준
- 미결: 전문가 네트워크 연동, 다국어 지원

---

### 10) 마일스톤·KPI

- M1 (4주): 3단계 입력·채점·Δ·레이더/히트맵 — KPI: 완주율 ≥70%
- M2 (4주): 플래그/코칭 카드·PDF — KPI: Top‑3 클릭률 ≥60%
- M3 (4주): 안전/알림·리마인드 — KPI: 재방문(4주) ≥35%
- M4 (4주): 상담 연계 α — KPI: 과제 이행 보고율 ≥50%

---

### 11) 지표 (Metrics) · 테스트 (Tests) · 추적 (Traceability)

**Metrics**
M-001 API P95, M-002 API Error, M-003 LCP/INP/CLS, M-004 완료율, M-005 1단계 k≥3 달성률,
M-006 평균 Δ, M-007 고위험 Δ 건수, M-008 안전 안내 노출률, M-009 코칭 클릭률,
M-010 DecisionPacket 커버리지, M-011 RFC9457 커버리지, M-012 OTel TraceJoin.

**Tests**
T-001 채점/역채점 경계, T-002 Δ/하위척도 정확성, T-003 플래그 룰,
T-004 k<3 잠금, T-005 안전 안내, T-006 레이더/히트맵 렌더,
T-007 RFC9457 오류 스냅샷, T-008 요청 ID 전파/OTel 조인, T-009 PDF/noindex,
T-010 시나리오 카드/실습 버튼, T-011 성능(k6), T-012 E2E 5 플로우.

**Traceability (발췌)**
R-101 → T-012/M-004, R-103 → T-001/T-002/M-006, R-105 → T-003/M-007,
R-109 → T-004/M-005, R-108 → T-005/M-008, R-111 → T-007/M-011,
R-112 → T-008/M-012, R-113 → T-009/M-010.

---

### 12) 참조 문헌

- RFC 9457: Problem Details for HTTP APIs — https://www.rfc-editor.org/rfc/rfc9457.html
- OpenTelemetry FastAPI Instrumentation — https://opentelemetry-python-contrib.readthedocs.io
- Web Vitals — https://web.dev/articles/vitals
- Ad placement policies — https://support.google.com/adsense/answer/1346295
- Web Content Accessibility Guidelines (WCAG) 2.2 — https://www.w3.org/TR/WCAG22/


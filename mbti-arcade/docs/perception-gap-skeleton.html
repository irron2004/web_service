<!doctype html>
<html lang="ko" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>360Me – Perception Gap</title>
  <meta name="color-scheme" content="dark light" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>

  <style>
    /* ===== Design Tokens ===== */
    :root {
      --c-primary:#5B6AFF;
      --c-secondary:#12B8A6;
      --c-accent:#F59E0B;
      --c-bg:#0F172A;
      --c-surface:#111827;
      --c-text:#F8FAFC;
      --c-text-2:#CBD5E1;
      --c-border:#334155;

      --radius-sm:6px; --radius-md:10px; --radius-lg:16px; --radius-xl:24px;
      --shadow-sm:0 1px 2px rgba(0,0,0,.30);
      --shadow-md:0 4px 16px rgba(0,0,0,.35);

      --space-0:0; --space-1:4px; --space-2:8px; --space-3:12px; --space-4:16px;
      --space-5:20px; --space-6:24px; --space-7:32px; --space-8:40px;

      --font-kr: "SUIT Variable", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      --font-lat: "Inter Variable", system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;

      --fs-h1:28px; --lh-h1:36px;
      --fs-h2:22px; --lh-h2:30px;
      --fs-h3:18px; --lh-h3:26px;
      --fs-body:16px; --lh-body:24px;
      --fs-cap:13px; --lh-cap:18px;

      --focus-ring: 2px solid var(--c-primary);
    }
    @media (prefers-color-scheme: light) {
      :root {
        --c-bg:#FFFFFF;
        --c-surface:#F8FAFC;
        --c-text:#0B1220;
        --c-text-2:#475569;
        --c-border:#D0D7E2;
      }
    }

    /* ===== Resets (minimal) ===== */
    *,*::before,*::after{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:var(--font-kr);
      color:var(--c-text); background:var(--c-bg);
      line-height:var(--lh-body); font-size:var(--fs-body);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    img{max-width:100%; display:block}
    button{font:inherit}
    a{color:inherit; text-decoration:none}

    /* ===== Layout ===== */
    .container{max-width:1120px; margin:0 auto; padding:0 var(--space-6)}
    header{position:sticky; top:0; backdrop-filter:saturate(180%) blur(8px);
      background:color-mix(in oklab, var(--c-bg) 85%, transparent); border-bottom:1px solid var(--c-border); z-index:50}
    .nav{display:flex; align-items:center; justify-content:space-between; height:64px}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:28px; height:28px; border-radius:50%;
      background: conic-gradient(from 210deg, var(--c-primary), var(--c-secondary));
      box-shadow: inset 0 0 0 2px color-mix(in oklab, var(--c-bg) 70%, transparent);
    }
    .wordmark{font-weight:700; letter-spacing:.2px}
    .main{padding: var(--space-8) 0}

    /* ===== Components ===== */
    .card{
      background:var(--c-surface); border:1px solid var(--c-border);
      border-radius:var(--radius-lg); box-shadow:var(--shadow-sm);
      padding:var(--space-7);
    }
    .h1{font-size:var(--fs-h1); line-height:var(--lh-h1); margin:0 0 var(--space-4)}
    .h2{font-size:var(--fs-h2); line-height:var(--lh-h2); margin:0 0 var(--space-3)}
    .h3{font-size:var(--fs-h3); line-height:var(--lh-h3); margin:0 0 var(--space-2)}
    .muted{color:var(--c-text-2)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      border-radius:var(--radius-md); padding:12px 16px; border:1px solid transparent;
      cursor:pointer; transition: transform .06s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .btn:active{transform:translateY(1px)}
    .btn:focus-visible{outline:var(--focus-ring); outline-offset:2px}
    .btn--primary{background:var(--c-primary); color:white}
    .btn--secondary{background:var(--c-secondary); color:#031a15}
    .btn--ghost{background:transparent; color:var(--c-text); border-color:var(--c-border)}

    .badge{display:inline-flex; align-items:center; gap:6px; padding:4px 8px; border-radius:999px;
      border:1px solid var(--c-border); color:var(--c-text-2); font-size:12px; line-height:16px}
    .badge--ok{border-color:color-mix(in oklab, var(--c-secondary) 60%, var(--c-border)); color:var(--c-secondary)}
    .badge--warn{border-color:color-mix(in oklab, var(--c-accent) 60%, var(--c-border)); color:var(--c-accent)}

    .grid{display:grid; gap:var(--space-7)}
    @media(min-width:768px){ .grid--2{grid-template-columns:1fr 1fr} }

    /* Tabs */
    .tabs{display:flex; gap:8px; border-bottom:1px solid var(--c-border); margin-bottom:16px}
    .tab{appearance:none; background:transparent; border:none; padding:10px 12px; border-radius:8px 8px 0 0; color:var(--c-text-2)}
    .tab[aria-selected="true"]{color:var(--c-text); background:var(--c-surface); border:1px solid var(--c-border); border-bottom:none}

    /* Form: Likert */
    .likert{display:grid; gap:12px}
    .q{display:grid; gap:8px; padding:12px; border:1px solid var(--c-border); border-radius:12px}
    .scale{display:flex; gap:8px; flex-wrap:wrap}
    .radio{
      position:relative; display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border:1px solid var(--c-border); border-radius:10px; cursor:pointer;
    }
    .radio input{position:absolute; inset:0; opacity:0}
    .radio:has(input:checked){border-color:var(--c-primary); background:color-mix(in oklab, var(--c-primary) 16%, transparent)}

    /* Charts */
    .chart-box{background:var(--c-surface); border:1px solid var(--c-border); border-radius:16px; padding:16px}
    .chart-legend{display:flex; gap:12px; align-items:center; flex-wrap:wrap; color:var(--c-text-2); font-size:13px}
    .dot{width:10px; height:10px; border-radius:50%}
    .dot--self{background:var(--c-primary)}
    .dot--others{background:var(--c-secondary)}
    .dot--band{background:color-mix(in oklab, var(--c-secondary) 35%, transparent)}

    /* Lock state */
    .lock{display:flex; flex-direction:column; align-items:flex-start; gap:12px; padding:16px; border:1px dashed var(--c-border);
      border-radius:12px; background:color-mix(in oklab, var(--c-bg) 86%, black 14%)}

    /* Toast */
    .toast{position:fixed; right:16px; bottom:16px; display:none; max-width:360px; padding:12px 14px; border-radius:10px;
      background:#0b1a2f; border:1px solid var(--c-border); color:var(--c-text); box-shadow:var(--shadow-md)}
    .toast[data-show="true"]{display:block}

    /* Error(RFC 9457) */
    .error{border:1px solid color-mix(in oklab, var(--c-accent) 60%, var(--c-border)); background:color-mix(in oklab, var(--c-accent) 12%, transparent);
      border-radius:12px; padding:16px; color:var(--c-text)}

    /* Provenance Drawer */
    details.provenance{border-top:1px dashed var(--c-border); padding-top:12px; margin-top:12px}
    details.provenance summary{cursor:pointer; color:var(--c-text-2)}
    details.provenance table{width:100%; border-collapse:collapse; margin-top:8px; font-size:13px}
    details.provenance td{padding:6px 0; border-bottom:1px dashed var(--c-border)}

    /* Ads placeholders */
    .ad-slot{border:1px dashed var(--c-border); border-radius:10px; padding:10px; color:var(--c-text-2); text-align:center}

    /* Focus */
    :focus-visible{outline:var(--focus-ring); outline-offset:2px}

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      *{animation:none!important; transition:none!important}
    }
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="wordmark">360Me</div>
      </div>
      <nav aria-label="주요">
        <a class="btn btn--ghost" href="#flow">프로세스</a>
        <a class="btn btn--ghost" href="#results">결과</a>
        <button class="btn btn--primary" onclick="scrollToId('test')">시작하기</button>
      </nav>
    </div>
  </header>

  <main class="main container">
    <!-- Hero / Landing -->
    <section class="grid" id="landing" aria-labelledby="landing-title">
      <div class="card">
        <h1 class="h1" id="landing-title">내가 생각한 나 vs 사람들이 보는 나</h1>
        <p class="muted">*If I were you* — 타인의 렌즈로 본 나를 안전하게 비교합니다. 결과는 항상 <strong>k/σ/시점</strong>과 함께 표시됩니다.</p>
        <div style="display:flex; gap:12px; margin-top:16px">
          <button class="btn btn--primary" onclick="selectMode('couple')">연인모드</button>
          <button class="btn btn--secondary" onclick="selectMode('friends')">친구모드</button>
          <button class="btn btn--ghost" onclick="selectMode('solo')">기본</button>
        </div>
      </div>
      <div class="card">
        <div class="h3">읽히는 한 장, 남는 근거</div>
        <ul class="muted">
          <li>32문항 → 링크 공유 → 다중 평가 집계 → 레이더/스캐터</li>
          <li>k &lt; 3 이면 결과 잠금(개인정보/오해 방지)</li>
          <li>OG 1200×630 자동 생성(공유 최적화)</li>
        </ul>
      </div>
    </section>

    <!-- Process -->
    <section id="flow" class="grid grid--2" aria-labelledby="flow-title" style="margin-top:40px">
      <div class="card">
        <h2 class="h2" id="flow-title">프로세스 3단계</h2>
        <ol>
          <li>테스트(8×4 페이지)</li>
          <li>초대 링크 생성(만료/최대인원/익명)</li>
          <li>결과 보기(레이더/스캐터/Gap)</li>
        </ol>
      </div>
      <div class="card ad-slot" aria-label="광고 슬롯(안전 간격 준수)">Ad Slot (결과 제목 아래용)</div>
    </section>

    <!-- Test (one page sample) -->
    <section id="test" class="card" style="margin-top:40px" aria-labelledby="test-title">
      <h2 class="h2" id="test-title">Self 테스트 (예시 8문항 중 1)</h2>
      <div class="likert" role="group" aria-label="문항 1 Likert">
        <div class="q">
          <div>1. 즉흥적인 제안을 반기는 편이다.</div>
          <div class="scale" role="radiogroup" aria-label="동의 정도 선택">
            <!-- 1~5 -->
            <label class="radio"><input type="radio" name="q1" value="1" />전혀 아니다</label>
            <label class="radio"><input type="radio" name="q1" value="2" />아니다</label>
            <label class="radio"><input type="radio" name="q1" value="3" />보통</label>
            <label class="radio"><input type="radio" name="q1" value="4" />그렇다</label>
            <label class="radio"><input type="radio" name="q1" value="5" />매우 그렇다</label>
          </div>
        </div>
      </div>
      <div style="display:flex; gap:12px; margin-top:16px">
        <button class="btn btn--ghost">이전</button>
        <button class="btn btn--primary" onclick="saveProgress()">저장하고 계속</button>
      </div>
    </section>

    <!-- Invite -->
    <section id="invite" class="card" style="margin-top:40px" aria-labelledby="invite-title">
      <h2 class="h2" id="invite-title">초대 링크 생성</h2>
      <div class="grid">
        <div class="grid grid--2">
          <div>
            <label>만료일 <input type="date" aria-label="만료일"/></label>
          </div>
          <div>
            <label>최대 인원 <input type="number" min="1" max="50" value="10" aria-label="최대 인원"/></label>
          </div>
          <div>
            <label><input type="checkbox" /> 익명(추천)</label>
          </div>
          <div>
            <label>관계 태그
              <select aria-label="관계 태그">
                <option>친구</option><option>연인</option><option>동료</option>
              </select>
            </label>
          </div>
        </div>
        <div>
          <button class="btn btn--secondary" onclick="copyInvite()">초대 링크 생성/복사</button>
          <span class="badge">예상 만료: <span id="exp">2025-10-31</span></span>
        </div>
      </div>
    </section>

    <!-- Results -->
    <section id="results" class="grid" style="margin-top:40px" aria-labelledby="results-title">
      <div class="card">
        <h2 class="h2" id="results-title">결과 보기</h2>
        <div id="summary" style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:8px">
          <span class="badge">GapScore <strong id="gapScore">62</strong>/100</span>
          <span class="badge" id="kBadge">k=6</span>
          <span class="badge">σ=0.18</span>
          <span class="badge">시점 <time id="ts"></time></span>
        </div>

        <!-- k<3 Lock -->
        <div id="lock" class="lock" hidden>
          <div class="h3">결과 잠금됨(k&lt;3)</div>
          <p class="muted">안전과 왜곡 방지를 위해 표본이 3명 미만일 때 결과를 숨깁니다. 더 많은 평가를 받아보세요.</p>
          <button class="btn btn--primary" onclick="copyInvite()">초대 더 받기</button>
        </div>

        <!-- Charts -->
        <div id="charts" class="grid grid--2">
          <div class="chart-box">
            <div class="h3" style="margin-bottom:8px">레이더 (EI/SN/TF/JP)</div>
            <canvas id="radar" aria-label="레이더 차트" role="img"></canvas>
            <div class="chart-legend" style="margin-top:8px">
              <span class="dot dot--band" aria-hidden="true"></span> σ 밴드(others)
              <span class="dot dot--others" aria-hidden="true"></span> Others 평균
              <span class="dot dot--self" aria-hidden="true"></span> Self
              <span class="badge badge--ok" id="concord">합의도 높음</span>
            </div>
          </div>

          <div class="chart-box">
            <div class="tabs" role="tablist" aria-label="스캐터 탭">
              <button class="tab" role="tab" aria-selected="true" aria-controls="sc-ei">EI–SN</button>
              <button class="tab" role="tab" aria-selected="false" aria-controls="sc-tf">TF–JP</button>
            </div>
            <div id="sc-ei" role="tabpanel"><canvas id="scatter-ei"></canvas></div>
            <div id="sc-tf" role="tabpanel" hidden><canvas id="scatter-tf"></canvas></div>
            <div class="chart-legend" style="margin-top:8px">
              <span class="dot dot--others"></span> Others 점
              <span class="dot dot--self"></span> Self
            </div>
          </div>
        </div>

        <!-- Gap Arrow Card -->
        <div class="card" style="margin-top:16px">
          <div class="h3">Gap 인사이트</div>
          <p class="muted" id="gapCopy">
            친구들은 당신을 <strong>E에 가깝다(+0.35)</strong>고 봤어요.
            의견은 <strong>거의 일치(σ=0.12, k=6)</strong>했죠. <strong>즉흥 제안</strong>에서 특히 E 성향이 두드러졌습니다.
          </p>

          <!-- Ad slot under title (safely spaced) -->
          <div class="ad-slot" style="margin:12px 0">Ad Slot (본문 중간)</div>

          <!-- Provenance Drawer -->
          <details class="provenance" id="prov">
            <summary>근거/출처(프로버넌스) 보기</summary>
            <table aria-label="프로버넌스 표">
              <tr><td>engine</td><td><code>core_scoring@1.3.2</code> (commit <code>ab12cde</code>)</td></tr>
              <tr><td>testSpec</td><td>MBTI‑style 32Q (비공식 문항, 해석주의)</td></tr>
              <tr><td>timestamp</td><td><time id="prov-ts"></time></td></tr>
              <tr><td>k / σ</td><td><span id="prov-k">6</span> / <span id="prov-sigma">0.18</span></td></tr>
              <tr><td>traceId</td><td><code id="traceId"></code> <button class="btn btn--ghost" onclick="copyTrace()">복사</button></td></tr>
            </table>
          </details>
        </div>
      </div>

      <div class="card ad-slot">Ad Slot (하단)</div>

      <!-- RFC 9457 error area (hidden by default) -->
      <div id="error" class="error" hidden role="alert">
        <div class="h3">문제가 발생했습니다</div>
        <p id="errTitle"></p>
        <p class="muted" id="errDetail"></p>
        <small class="muted">코드 <span id="errStatus"></span> · <a id="errInstance" href="#" target="_blank" rel="noopener">자세히</a></small>
      </div>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // ===== Utilities =====
    function $(sel, root=document){ return root.querySelector(sel) }
    function $all(sel, root=document){ return Array.from(root.querySelectorAll(sel)) }
    function toast(msg){ const t=$("#toast"); t.textContent=msg; t.dataset.show="true"; setTimeout(()=>t.dataset.show="false", 2200) }
    function scrollToId(id){ document.getElementById(id)?.scrollIntoView({behavior:"smooth"}) }
    function selectMode(mode){ toast(`모드 선택: ${mode}`) }
    function saveProgress(){ toast("진행 상황을 저장했어요") }
    function copyInvite(){
      navigator.clipboard.writeText(location.origin + "/i/abc123").then(()=>toast("초대 링크를 복사했어요"))
    }
    function copyTrace(){
      const v = $("#traceId").textContent.trim(); if (!v) return;
      navigator.clipboard.writeText(v).then(()=>toast("traceId를 복사했어요"))
    }
    function formatIso(dt=new Date()){ return new Date(dt).toISOString().replace('T',' ').replace('Z',' UTC') }

    // ===== Tabs =====
    $all('.tab').forEach(tab=>{
      tab.addEventListener('click', (e)=>{
        const group = tab.closest('.chart-box'); if(!group) return;
        $all('[role="tab"]', group).forEach(t=>t.setAttribute('aria-selected','false'));
        tab.setAttribute('aria-selected','true');
        $all('[role="tabpanel"]', group).forEach(p=>p.hidden=true);
        document.getElementById(tab.getAttribute('aria-controls')).hidden=false;
      })
    })

    // ===== Demo data (replace with API) =====
    const demo = {
      k: 6, sigma: 0.18, gapScore: 62,
      radar: {
        labels: ["EI","SN","TF","JP"],
        self:   [72, 41, 66, 58],             // 0~100
        mean:   [65, 48, 60, 52],             // Others 평균
        sigma:  [8, 12, 10, 9]                // 표준편차(시각화용)
      },
      scatter: {
        ei: { self: {x:72,y:41}, others: mkOthers(20, (x)=>x+rand(-6,6), (y)=>y+rand(-6,6)) },
        tf: { self: {x:66,y:58}, others: mkOthers(20, (x)=>x+rand(-6,6), (y)=>y+rand(-6,6)) }
      },
      traceId: cryptoRandomId()
    };
    function cryptoRandomId() {
      const a = crypto.getRandomValues(new Uint8Array(16));
      return [...a].map(x=>x.toString(16).padStart(2,'0')).join('');
    }
    function rand(min,max){ return Math.round(Math.random()*(max-min)+min) }
    function mkOthers(n,fx,fy){
      const baseX=60, baseY=50;
      return Array.from({length:n},()=>({x:fx(baseX), y:fy(baseY)}))
    }

    // ===== k<3 lock =====
    function applySummary(d){
      $("#gapScore").textContent = d.gapScore;
      $("#kBadge").textContent = `k=${d.k}`;
      $("#ts").textContent = formatIso();
      $("#prov-ts").textContent = formatIso();
      $("#prov-k").textContent = d.k;
      $("#prov-sigma").textContent = d.sigma.toFixed(2);
      $("#traceId").textContent = d.traceId;

      const lock = d.k < 3;
      document.getElementById('lock').hidden = !lock;
      document.getElementById('charts').hidden = lock;

      // 합의도 배지 색상(예시 규칙)
      const concord = document.getElementById('concord');
      if (d.sigma < 0.15) { concord.textContent = "합의도 높음"; concord.className = "badge badge--ok"; }
      else if (d.sigma <= 0.35) { concord.textContent = "합의도 보통"; concord.className = "badge"; }
      else { concord.textContent = "불일치 높음"; concord.className = "badge badge--warn"; }
    }

    // ===== Charts (Chart.js) =====
    let radarChart, scEI, scTF;
    function initCharts(d){
      // Radar with σ band: use two datasets (lower/upper) and fill between
      const ctxR = document.getElementById('radar').getContext('2d');
      const lower = d.radar.mean.map((m,i)=>Math.max(0, m - d.radar.sigma[i]));
      const upper = d.radar.mean.map((m,i)=>Math.min(100, m + d.radar.sigma[i]));

      radarChart = new Chart(ctxR, {
        type: 'radar',
        data: {
          labels: d.radar.labels,
          datasets: [
            { // lower bound (hidden line)
              label: 'σ-',
              data: lower,
              borderWidth: 0,
              backgroundColor: 'transparent'
            },
            { // upper bound filled to previous (σ band)
              label: 'σ band',
              data: upper,
              borderWidth: 0,
              backgroundColor: 'rgba(18,184,166,0.28)',
              fill: '-1'
            },
            { // others mean (dashed)
              label: 'Others 평균',
              data: d.radar.mean,
              borderColor: 'rgba(18,184,166,1)',
              backgroundColor: 'rgba(18,184,166,0.12)',
              borderDash: [6,4],
              pointRadius: 2,
              tension: 0.2
            },
            { // self
              label: 'Self',
              data: d.radar.self,
              borderColor: 'rgba(91,106,255,1)',
              backgroundColor: 'rgba(91,106,255,0.18)',
              pointRadius: 3,
              tension: 0.2
            }
          ]
        },
        options: {
          responsive: true,
          scales: {
            r: {
              min: 0, max: 100, ticks: { display: false },
              grid: { color: 'rgba(203,213,225,0.25)' },
              angleLines: { color: 'rgba(203,213,225,0.25)' },
              pointLabels: { color: 'var(--c-text)' }
            }
          },
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.formattedValue}` }
            }
          },
          animation: { duration: 420 }
        }
      });

      // Scatter EI, SN
      const baseSc = (el, self, others)=> new Chart(el.getContext('2d'), {
        type: 'scatter',
        data: {
          datasets: [
            { label:'Others', data: others, pointRadius: 3, backgroundColor:'rgba(18,184,166,0.9)' },
            { label:'Self', data: [self], pointRadius: 5, backgroundColor:'rgba(91,106,255,1)' }
          ]
        },
        options: {
          responsive:true,
          scales: {
            x: { min: 0, max: 100, grid:{color:'rgba(203,213,225,0.25)'}, title:{display:true, text:'축1'} },
            y: { min: 0, max: 100, grid:{color:'rgba(203,213,225,0.25)'}, title:{display:true, text:'축2'} }
          },
          plugins: { legend:{ display:false } },
          animation: { duration: 300 }
        }
      });

      scEI = baseSc(document.getElementById('scatter-ei'), d.scatter.ei.self, d.scatter.ei.others);
      scTF = baseSc(document.getElementById('scatter-tf'), d.scatter.tf.self, d.scatter.tf.others);
    }

    // ===== RFC 9457 error mapping (demo) =====
    function showProblem(p){
      const box = $("#error");
      $("#errTitle").textContent = p.title || "Unknown";
      $("#errDetail").textContent = p.detail || "";
      $("#errStatus").textContent = p.status || "-";
      $("#errInstance").href = p.instance || "#";
      box.hidden = false;
    }
    // Example: showProblem({title:"Too Many Requests", detail:"Rate limit exceeded", status:429, instance:"/errors/429-xy"});

    // ===== Init =====
    window.addEventListener('DOMContentLoaded', ()=>{
      applySummary(demo);
      initCharts(demo);
    });
  </script>
</body>
</html>

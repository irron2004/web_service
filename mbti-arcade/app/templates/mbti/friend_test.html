{% extends "base.html" %}

{% block title %}ì¹œêµ¬ MBTI í…ŒìŠ¤íŠ¸ - MBTI & Arcade Web Service{% endblock %}

{% block head %}
{{ super() }}
<style>
    .question-card:focus-within {
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.25);
        border-color: rgba(124, 58, 237, 0.6);
    }

    .scale-option:focus-visible {
        outline: 3px solid rgba(124, 58, 237, 0.9);
        outline-offset: 4px;
    }

    .relation-option {
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 1rem;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        background: rgba(255, 255, 255, 0.9);
    }

    .relation-option:focus-within {
        border-color: rgba(124, 58, 237, 0.55);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    }

    .relation-option input:checked + .relation-body {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(59, 130, 246, 0.9));
        color: #fff;
    }

    .relation-body {
        border-radius: 0.9rem;
        padding: 1rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 100%;
        transition: background 0.2s ease, color 0.2s ease;
    }

    .relation-body span {
        color: inherit;
    }
</style>
{% endblock %}

{% block content %}
{% set target_name = (friend.name if friend else friend_name) or "ì¹œêµ¬" %}
{% set owner_name = friend_name or "ê³µìœ ì" %}
{% set owner_mbti = my_mbti or "ë¹„ê³µê°œ" %}
{% set scale_options = [
    (1, "ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤"),
    (2, "ê·¸ë ‡ì§€ ì•Šì€ í¸"),
    (3, "ë³´í†µ"),
    (4, "ê·¸ëŸ° í¸"),
    (5, "ë§¤ìš° ê·¸ë ‡ë‹¤")
] %}
{% set relation_labels = {
    "friend": "ì¹œêµ¬",
    "boyfriend": "ë‚¨ìì¹œêµ¬",
    "girlfriend": "ì—¬ìì¹œêµ¬",
    "partner": "ì—°ì¸",
    "couple": "ë°°ìš°ì",
    "family": "ê°€ì¡±",
    "colleague": "ë™ë£Œ",
    "acquaintance": "ì§€ì¸"
} %}
{% set relation_notes = {
    "friend": "í•¨ê»˜ ì‹œê°„ì„ ìì£¼ ë³´ë‚´ëŠ” ì¹œêµ¬",
    "boyfriend": "ì—°ì¸ ê´€ê³„ (ë‚¨ìì¹œêµ¬)",
    "girlfriend": "ì—°ì¸ ê´€ê³„ (ì—¬ìì¹œêµ¬)",
    "partner": "ì»¤í”Œ/íŒŒíŠ¸ë„ˆ ê´€ê³„",
    "couple": "ë°°ìš°ì Â· ê²°í˜¼ ê´€ê³„",
    "family": "ê°€ì¡±/ì¹œì²™",
    "colleague": "ì§ì¥ Â· í”„ë¡œì íŠ¸ ë™ë£Œ",
    "acquaintance": "ìˆ˜ì—…/ë™í˜¸íšŒ ë“± ì§€ì¸"
} %}

<div class="mx-auto max-w-5xl space-y-10">
    <section class="rounded-3xl bg-gradient-to-br from-purple-600 via-sky-600 to-emerald-500 px-6 py-10 text-white">
        <div class="space-y-5">
            <span class="inline-flex items-center rounded-full bg-white/15 px-4 py-1 text-xs font-semibold uppercase tracking-wide">Invite â†’ Aggregate ë‹¨ê³„</span>
            <h1 class="text-3xl md:text-4xl font-bold leading-tight">ğŸ¯ {{ target_name }}ë¥¼ ìœ„í•œ MBTI ê´€ì  í‰ê°€</h1>
            <p class="text-base md:text-lg text-white/90">
                {{ owner_name }}ë‹˜ì˜ ìê¸° ì¸ì‹(Self) ì‘ë‹µê³¼ ë¹„êµí•´, ì£¼ë³€ ì‹œì„ ì´ ì–´ë–»ê²Œ ë‹¤ë¥¸ì§€ í™•ì¸í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤.
                ì‘ë‹µì€ kâ‰¥3ëª…ì´ ëª¨ì¼ ë•Œë§Œ ì§‘ê³„Â·ê³µìœ ë˜ë©°, ê²°ê³¼ëŠ” Î” ì§€í‘œì™€ ë ˆì´ë” ì°¨íŠ¸ë¡œ ì‹œê°í™”ë©ë‹ˆë‹¤.
            </p>
            <dl class="grid gap-4 rounded-2xl bg-white/15 p-4 text-sm md:grid-cols-3">
                <div>
                    <dt class="font-semibold text-white/70">ê³µìœ ì</dt>
                    <dd class="mt-1 text-white font-semibold">{{ owner_name }}</dd>
                </div>
                <div>
                    <dt class="font-semibold text-white/70">ê³µìœ ì MBTI</dt>
                    <dd class="mt-1 text-white font-semibold">{{ owner_mbti }}</dd>
                </div>
                <div>
                    <dt class="font-semibold text-white/70">í‰ê°€ ëŒ€ìƒ</dt>
                    <dd class="mt-1 text-white font-semibold">{{ target_name }}</dd>
                </div>
            </dl>
        </div>
    </section>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-xl font-semibold text-slate-900">í…ŒìŠ¤íŠ¸ ì•ˆë‚´</h2>
        <p class="mt-3 text-sm text-slate-600">
            ê° ë¬¸í•­ì€ "ê·¸ ì‚¬ëŒì€â€¦"ì´ë¼ëŠ” ì œ3ì ê´€ì  ì§ˆë¬¸ì…ë‹ˆë‹¤. {{ target_name }}ì´ ì¼ìƒì—ì„œ ë³´ì—¬ì£¼ëŠ” í–‰ë™ê³¼
            íŠ¹ì„±ì„ ë– ì˜¬ë¦¬ë©° ì†”ì§í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”. ëª¨ë“  ë¬¸í•­ì€ 1(ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤)ì—ì„œ 5(ë§¤ìš° ê·¸ë ‡ë‹¤) ì‚¬ì´ì˜
            Likert ì²™ë„ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
        </p>
        <ul class="mt-4 grid gap-3 text-sm text-slate-600 md:grid-cols-3">
            <li class="rounded-xl bg-slate-50 px-4 py-3">âœ… ì‘ë‹µì€ ìµëª…ìœ¼ë¡œ ì €ì¥ë˜ë©°, ì§‘ê³„ ê²°ê³¼ì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
            <li class="rounded-xl bg-slate-50 px-4 py-3">ğŸ“¬ {{ owner_name }}ë‹˜ì´ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³  Î” ì¸ì‚¬ì´íŠ¸ë¥¼ ê³µìœ í•©ë‹ˆë‹¤.</li>
            <li class="rounded-xl bg-slate-50 px-4 py-3">ğŸ§  Î” â‰¥ 1.6ì¸ í•­ëª©ì€ ê³ ìœ„í—˜ ì‹ í˜¸ë¡œ í‘œì‹œë˜ì–´ ì¶”ê°€ ì¡°ì–¸ì´ ì œê³µë©ë‹ˆë‹¤.</li>
        </ul>
    </section>

    <form action="/mbti/result/{{ token }}" method="POST" class="space-y-8">
        <input type="hidden" name="token" value="{{ token }}">

        <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <fieldset aria-describedby="relation-hint">
                <legend class="text-xl font-semibold text-slate-900">ğŸ¤ {{ target_name }}ì™€ì˜ ê´€ê³„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</legend>
                <p class="mt-2 text-sm text-slate-500" id="relation-hint">
                    ì„ íƒí•œ ê´€ê³„ëŠ” Î” ê³„ì‚° ì‹œ ê°€ì¤‘ì¹˜(Weight)ë¡œ ë°˜ì˜ë©ë‹ˆë‹¤.
                </p>
                <div class="mt-5 grid gap-4 sm:grid-cols-2">
                    {% for relation in relations %}
                    {% set option_id = "relation-" ~ loop.index %}
                    {% set label_text = relation_labels.get(relation, relation.replace('_', ' ')|title) %}
                    {% set note_text = relation_notes.get(relation) %}
                    <label class="relation-option block" for="{{ option_id }}">
                        <input type="radio" id="{{ option_id }}" name="relation" value="{{ relation }}" {% if loop.first %}required{% endif %} class="sr-only">
                        <div class="relation-body">
                            <span class="text-base font-semibold">{{ label_text }}</span>
                            {% if note_text %}
                            <span class="text-xs opacity-80">{{ note_text }}</span>
                            {% endif %}
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </fieldset>
        </section>

        <section class="space-y-6">
            {% for question in questions %}
            {% set base_name = "q" ~ question.id %}
            <fieldset class="question-card rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors" aria-describedby="{{ base_name }}-hint">
                <legend class="flex items-start gap-3 text-lg font-semibold text-slate-900">
                    <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-purple-600 text-sm font-bold text-white">{{ loop.index }}</span>
                    <span>{{ question.question }}</span>
                </legend>
                <p id="{{ base_name }}-hint" class="mt-3 text-sm text-slate-500">
                    1ì€ "ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤", 5ëŠ” "ë§¤ìš° ê·¸ë ‡ë‹¤"ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ë°©í–¥í‚¤ ë˜ëŠ” íƒ­+ìŠ¤í˜ì´ìŠ¤ë¡œ ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
                <div class="mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-5" role="radiogroup">
                    {% for value, label in scale_options %}
                    {% set input_id = base_name ~ "-" ~ loop.index %}
                    <label for="{{ input_id }}" class="scale-option flex items-center gap-3 rounded-xl border border-slate-200 px-4 py-3 text-sm font-medium text-slate-700 transition hover:border-purple-400 hover:bg-purple-50">
                        <input id="{{ input_id }}" type="radio" name="{{ base_name }}" value="{{ value }}" class="h-4 w-4 text-purple-600" {% if loop.first %}required{% endif %}>
                        <span>{{ label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </fieldset>
            {% endfor %}
        </section>

        <div class="sticky bottom-6 z-10 flex justify-end">
            <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-purple-600 via-indigo-600 to-sky-500 px-6 py-3 text-base font-semibold text-white shadow-lg shadow-indigo-600/30 transition hover:-translate-y-0.5">
                ğŸš€ í‰ê°€ ì œì¶œí•˜ê¸°
            </button>
        </div>
    </form>

    <section class="grid gap-6 rounded-2xl border border-amber-200 bg-amber-50 p-6 text-sm text-amber-700 md:grid-cols-2">
        <div>
            <h3 class="text-base font-semibold text-amber-800">ğŸ’¡ ê°ê´€ì ìœ¼ë¡œ í‰ê°€í•˜ëŠ” íŒ</h3>
            <ul class="mt-3 space-y-1">
                <li>â€¢ ìµœê·¼ í•œë‘ ë²ˆì˜ ìƒí™©ë³´ë‹¤, í‰ì†Œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ì„ ë– ì˜¬ë ¤ ë³´ì„¸ìš”.</li>
                <li>â€¢ ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ í•¨ê»˜ ìˆì„ ë•Œì˜ ëª¨ìŠµì„ ìƒìƒí•´ë³´ë©´ í•œì¸µ ì •í™•í•´ì§‘ë‹ˆë‹¤.</li>
                <li>â€¢ ì• ë§¤í•˜ë©´ ì¤‘ê°„ê°’(3)ì„ ì„ íƒí•˜ê³ , í™•ì‹ ì´ ìˆì„ ë•Œë§Œ ê·¹ë‹¨ê°’ì„ ì„ íƒí•˜ì„¸ìš”.</li>
            </ul>
        </div>
        <div>
            <h3 class="text-base font-semibold text-amber-800">ğŸ“Š ê²°ê³¼ëŠ” ì´ë ‡ê²Œ í™œìš©ë¼ìš”</h3>
            <ul class="mt-3 space-y-1">
                <li>â€¢ Self â†” Others ê°„ Î”, Ïƒ, Top-3 ì´ìŠˆ ì¹´ë“œê°€ ìƒì„±ë©ë‹ˆë‹¤.</li>
                <li>â€¢ Î” â‰¥ 1.6 í•­ëª©ì€ ê³ ìœ„í—˜ êµ¬ê°„ìœ¼ë¡œ í‘œì‹œë˜ì–´ ì½”ì¹­ ì¹´ë“œê°€ ë”°ë¼ì˜µë‹ˆë‹¤.</li>
                <li>â€¢ ê²°ê³¼ëŠ” RFC 9457 Problem Details, X-Request-ID ë¡œê·¸ì™€ í•¨ê»˜ ì €ì¥ë©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </section>
</div>
{% endblock %}

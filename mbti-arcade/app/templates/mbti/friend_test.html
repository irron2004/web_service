{% extends "base.html" %}

{% block title %}친구 MBTI 테스트 - MBTI & Arcade Web Service{% endblock %}

{% block head %}
{{ super() }}
<style>
    .question-card:focus-within {
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.25);
        border-color: rgba(124, 58, 237, 0.6);
    }

    .scale-option:focus-visible {
        outline: 3px solid rgba(124, 58, 237, 0.9);
        outline-offset: 4px;
    }

    .relation-option {
        border: 1px solid rgba(148, 163, 184, 0.35);
        border-radius: 1rem;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        background: rgba(255, 255, 255, 0.9);
    }

    .relation-option:focus-within {
        border-color: rgba(124, 58, 237, 0.55);
        box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.2);
    }

    .relation-option input:checked + .relation-body {
        background: linear-gradient(135deg, rgba(124, 58, 237, 0.9), rgba(59, 130, 246, 0.9));
        color: #fff;
    }

    .relation-body {
        border-radius: 0.9rem;
        padding: 1rem 1.25rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        min-height: 100%;
        transition: background 0.2s ease, color 0.2s ease;
    }

    .relation-body span {
        color: inherit;
    }
</style>
{% endblock %}

{% block content %}
{% set target_name = (friend.name if friend else friend_name) or "친구" %}
{% set owner_name = friend_name or "공유자" %}
{% set owner_mbti = my_mbti or "비공개" %}
{% set scale_options = [
    (1, "전혀 그렇지 않다"),
    (2, "그렇지 않은 편"),
    (3, "보통"),
    (4, "그런 편"),
    (5, "매우 그렇다")
] %}
{% set relation_labels = {
    "friend": "친구",
    "boyfriend": "남자친구",
    "girlfriend": "여자친구",
    "partner": "연인",
    "couple": "배우자",
    "family": "가족",
    "colleague": "동료",
    "acquaintance": "지인"
} %}
{% set relation_notes = {
    "friend": "함께 시간을 자주 보내는 친구",
    "boyfriend": "연인 관계 (남자친구)",
    "girlfriend": "연인 관계 (여자친구)",
    "partner": "커플/파트너 관계",
    "couple": "배우자 · 결혼 관계",
    "family": "가족/친척",
    "colleague": "직장 · 프로젝트 동료",
    "acquaintance": "수업/동호회 등 지인"
} %}

<div class="mx-auto max-w-5xl space-y-10">
    <section class="rounded-3xl bg-gradient-to-br from-purple-600 via-sky-600 to-emerald-500 px-6 py-10 text-white">
        <div class="space-y-5">
            <span class="inline-flex items-center rounded-full bg-white/15 px-4 py-1 text-xs font-semibold uppercase tracking-wide">초대 참여 안내</span>
            <h1 class="text-3xl md:text-4xl font-bold leading-tight">🎯 {{ target_name }}님을 떠올리며 응답해 주세요</h1>
            <p class="text-base md:text-lg text-white/90">
                {{ owner_name }}님이 마련한 인식 체크에 참여하는 단계입니다. 일상에서의 {{ target_name }}님의 모습을 떠올리며 솔직하게 답해 주세요.
                답변은 익명으로 모이고, 3명 이상이 참여하면 결과 요약이 열립니다.
            </p>
            <dl class="grid gap-4 rounded-2xl bg-white/15 p-4 text-sm md:grid-cols-3">
                <div>
                    <dt class="font-semibold text-white/70">공유자</dt>
                    <dd class="mt-1 text-white font-semibold">{{ owner_name }}</dd>
                </div>
                <div>
                    <dt class="font-semibold text-white/70">공유자 MBTI</dt>
                    <dd class="mt-1 text-white font-semibold">{{ owner_mbti }}</dd>
                </div>
                <div>
                    <dt class="font-semibold text-white/70">평가 대상</dt>
                    <dd class="mt-1 text-white font-semibold">{{ target_name }}</dd>
                </div>
            </dl>
        </div>
    </section>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-xl font-semibold text-slate-900">참여 방법</h2>
        <p class="mt-3 text-sm text-slate-600">
            질문은 모두 "그 사람은…" 형식입니다. {{ target_name }}님이 평소에 보여주는 모습을 떠올리며, 가장 가까운 선택지를 골라 주세요.
            1은 "전혀 그렇지 않다", 5는 "매우 그렇다"를 뜻합니다.
        </p>
        <ul class="mt-4 grid gap-3 text-sm text-slate-600 md:grid-cols-3">
            <li class="rounded-xl bg-slate-50 px-4 py-3">✅ 답변은 익명으로 저장되며, 요약 결과에만 활용됩니다.</li>
            <li class="rounded-xl bg-slate-50 px-4 py-3">📬 {{ owner_name }}님이 결과 요약을 확인하고 공유 여부를 결정합니다.</li>
            <li class="rounded-xl bg-slate-50 px-4 py-3">📈 3명 이상 참여하면 강점과 차이점을 그래프로 보여드려요.</li>
        </ul>
    </section>

    <form action="/mbti/result/{{ token }}" method="POST" class="space-y-8">
        <input type="hidden" name="token" value="{{ token }}">

        <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
            <fieldset aria-describedby="relation-hint">
                <legend class="text-xl font-semibold text-slate-900">🤝 {{ target_name }}님과의 관계를 선택해 주세요</legend>
                <p class="mt-2 text-sm text-slate-500" id="relation-hint">
                    응답자 정보를 간단히 남겨 두면 리포트에서 관계별로 모아볼 수 있습니다.
                </p>
                <div class="mt-5 grid gap-4 sm:grid-cols-2">
                    {% for relation in relations %}
                    {% set option_id = "relation-" ~ loop.index %}
                    {% set label_text = relation_labels.get(relation, relation.replace('_', ' ')|title) %}
                    {% set note_text = relation_notes.get(relation) %}
                    <label class="relation-option block" for="{{ option_id }}">
                        <input type="radio" id="{{ option_id }}" name="relation" value="{{ relation }}" {% if loop.first %}required{% endif %} class="sr-only">
                        <div class="relation-body">
                            <span class="text-base font-semibold">{{ label_text }}</span>
                            {% if note_text %}
                            <span class="text-xs opacity-80">{{ note_text }}</span>
                            {% endif %}
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </fieldset>
        </section>

        <section class="space-y-6">
            {% for question in questions %}
            {% set base_name = "q" ~ question.id %}
            <fieldset class="question-card rounded-2xl border border-slate-200 bg-white p-6 shadow-sm transition-colors" aria-describedby="{{ base_name }}-hint">
                <legend class="flex items-start gap-3 text-lg font-semibold text-slate-900">
                    <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-purple-600 text-sm font-bold text-white">{{ loop.index }}</span>
                    <span>{{ question.question }}</span>
                </legend>
                <p id="{{ base_name }}-hint" class="mt-3 text-sm text-slate-500">
                    방향키 또는 탭+스페이스로도 선택할 수 있어요. 고민될 땐 가장 가까운 쪽을 선택해 주세요.
                </p>
                <div class="mt-5 grid gap-3 sm:grid-cols-2 lg:grid-cols-5" role="radiogroup">
                    {% for value, label in scale_options %}
                    {% set input_id = base_name ~ "-" ~ loop.index %}
                    <label for="{{ input_id }}" class="scale-option flex items-center gap-3 rounded-xl border border-slate-200 px-4 py-3 text-sm font-medium text-slate-700 transition hover:border-purple-400 hover:bg-purple-50">
                        <input id="{{ input_id }}" type="radio" name="{{ base_name }}" value="{{ value }}" class="h-4 w-4 text-purple-600" {% if loop.first %}required{% endif %}>
                        <span>{{ label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </fieldset>
            {% endfor %}
        </section>

        <div class="sticky bottom-6 z-10 flex justify-end">
            <button type="submit" class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-purple-600 via-indigo-600 to-sky-500 px-6 py-3 text-base font-semibold text-white shadow-lg shadow-indigo-600/30 transition hover:-translate-y-0.5">
                🚀 평가 제출하기
            </button>
        </div>
    </form>

    <section class="grid gap-6 rounded-2xl border border-amber-200 bg-amber-50 p-6 text-sm text-amber-700 md:grid-cols-2">
        <div>
            <h3 class="text-base font-semibold text-amber-800">💡 더 정확하게 답하는 방법</h3>
            <ul class="mt-3 space-y-1">
                <li>• 최근 한두 번의 일보다, 평소 반복되는 모습을 떠올려 보세요.</li>
                <li>• 함께 지낸 다양한 순간을 돌이켜 보면 도움이 됩니다.</li>
                <li>• 애매하면 중간값을 선택해도 괜찮아요. 확신이 있을 때만 극단값을 선택하세요.</li>
            </ul>
        </div>
        <div>
            <h3 class="text-base font-semibold text-amber-800">📊 결과는 이렇게 보여드려요</h3>
            <ul class="mt-3 space-y-1">
                <li>• 참여가 모이면 강점과 다른 점을 요약한 카드가 생성됩니다.</li>
                <li>• 관계별로 느낀 차이를 그래프와 문장으로 정리해 드립니다.</li>
                <li>• 제출한 답변은 안전하게 저장되어 나중에 다시 확인할 수 있어요.</li>
            </ul>
        </div>
    </section>
</div>
{% endblock %}

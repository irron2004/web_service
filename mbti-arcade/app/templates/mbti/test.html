{% extends "base.html" %}

{% block title %}MBTI í…ŒìŠ¤íŠ¸ - MBTI Insight Hub{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    {% set friend_name_value = friend_info.name if friend_info else request.query_params.get('friend_name', '') %}
    {% set friend_mbti_value = friend_info.mbti if friend_info else request.query_params.get('friend_mbti', request.query_params.get('mbti', '')) %}
    {% set relationship_value = friend_info.relationship if friend_info else request.query_params.get('relationship', '') %}
    {% set relation_label_value = friend_info.relation_label if friend_info else request.query_params.get('relation_label', '') %}
    {% set responder_value = friend_info.responder_name if friend_info else request.query_params.get('responder_name', '') %}
    {% set has_friend_context = friend_name_value or relationship_value or responder_value %}
    <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-4">
            {{ friend_name_value or 'ì¹œêµ¬' }} ë‹˜ì„ ë– ì˜¬ë¦¬ë©° ë‹µí•´ ì£¼ì„¸ìš”
        </h1>
        <p class="text-gray-600 mb-4">
            ë¬¸ì¥ì„ ì½ê³  ëŠë‚Œì— ê°€ì¥ ê°€ê¹Œìš´ ìª½ì„ ì„ íƒí•˜ë©´ ë©ë‹ˆë‹¤. ì •ë‹µì€ ì—†ì–´ìš”!
        </p>
        {% if has_friend_context %}
        <div class="bg-blue-50 p-4 rounded-lg max-w-2xl mx-auto text-left">
            <p class="text-sm text-blue-800">
                {% if friend_name_value %}
                    <strong>{{ friend_name_value }}</strong> ë‹˜ê³¼ì˜ ê´€ê³„ëŠ” <strong>{{ relation_label_value or 'ì¹œêµ¬' }}</strong>ì…ë‹ˆë‹¤.
                {% endif %}
                {% if responder_value %}
                    ë‚´ ë‹‰ë„¤ì„ì€ <strong>{{ responder_value }}</strong>ë¡œ ê¸°ë¡ë¼ìš”.
                {% else %}
                    ë‹‰ë„¤ì„ì„ ë¹„ì› ìœ¼ë¯€ë¡œ â€˜ìµëª…â€™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.
                {% endif %}
                {% if friend_mbti_value %}
                    ì°¸ê³ ë¡œ ì•Œê³  ìˆëŠ” ìœ í˜•ì€ {{ friend_mbti_value }}ì…ë‹ˆë‹¤.
                {% endif %}
            </p>
        </div>
        {% endif %}
    </div>

    <form method="POST" action="/mbti/result" class="bg-white rounded-lg shadow-lg p-8">
        <!-- ì¹œêµ¬ í‰ê°€ ì •ë³´ (URL íŒŒë¼ë¯¸í„° ë˜ëŠ” ì»¨í…ìŠ¤íŠ¸ì—ì„œ ê°€ì ¸ì˜´) -->
        <input type="hidden" name="friend_name" value="{{ friend_name_value }}">
        <input type="hidden" name="friend_mbti" value="{{ friend_mbti_value }}">
        <input type="hidden" name="relationship" value="{{ relationship_value }}">
        <input type="hidden" name="relation_label" value="{{ relation_label_value }}">
        <input type="hidden" name="responder_name" value="{{ responder_value }}">
        <input type="hidden" name="participant_id" value="{{ friend_info.participant_id if friend_info else '' }}">
        <input type="hidden" name="invite_token" value="{{ friend_info.invite_token if friend_info else '' }}">

        <!-- í‰ê°€ ì•ˆë‚´ -->
        <div class="mb-6 rounded-2xl border border-yellow-200 bg-yellow-50 p-4 text-sm text-yellow-800">
            <p><strong>Tip.</strong> â€œ{{ friend_name_value or 'ì¹œêµ¬' }}ëŠ” ëŒ€ê°œ â€¦â€ë¼ê³  ë§ˆìŒì†ìœ¼ë¡œ ì½ì–´ ë³´ë©° ëŠê»´ì§€ëŠ” ìª½ì„ ê³¨ë¼ ì£¼ì„¸ìš”. ê³ ë¯¼ì´ ë˜ë©´ ì²˜ìŒ ë– ì˜¤ë¥¸ ëŠë‚Œì„ ì„ íƒí•˜ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.</p>
        </div>

        {% for question in questions %}
        <div class="mb-8 p-6 border border-gray-200 rounded-lg hover:border-blue-300 transition-colors">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                {{ loop.index }}. 
                {% if friend_info %}
                    {% set question_text = question.question %}
                    {% set question_text = question_text.replace("ê·¸ ì‚¬ëŒì€", friend_info.name + "ì€") %}
                    {% set question_text = question_text.replace("ê·¸ ì‚¬ëŒì´", friend_info.name + "ì´") %}
                    {% set question_text = question_text.replace("ê·¸ ì‚¬ëŒì˜", friend_info.name + "ì˜") %}
                    {% set question_text = question_text.replace("ê·¸ ì‚¬ëŒì„", friend_info.name + "ì„") %}
                    {% set question_text = question_text.replace("ê·¸ ì‚¬ëŒê³¼", friend_info.name + "ê³¼") %}
                    {{ question_text }}
                {% else %}
                    {{ question.question }}
                {% endif %}
            </h3>
            
            <div class="space-y-3">
                <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="radio" name="q{{ question.id }}" value="1" class="mr-3 text-blue-600" required>
                    <span class="text-gray-700">ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤</span>
                </label>
                
                <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="radio" name="q{{ question.id }}" value="2" class="mr-3 text-blue-600" required>
                    <span class="text-gray-700">ê·¸ë ‡ì§€ ì•Šì€ í¸ì´ë‹¤</span>
                </label>
                
                <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="radio" name="q{{ question.id }}" value="3" class="mr-3 text-blue-600" required>
                    <span class="text-gray-700">ë³´í†µì´ë‹¤</span>
                </label>
                
                <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="radio" name="q{{ question.id }}" value="4" class="mr-3 text-blue-600" required>
                    <span class="text-gray-700">ê·¸ëŸ° í¸ì´ë‹¤</span>
                </label>
                
                <label class="flex items-center p-3 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 cursor-pointer transition-colors">
                    <input type="radio" name="q{{ question.id }}" value="5" class="mr-3 text-blue-600" required>
                    <span class="text-gray-700">ë§¤ìš° ê·¸ë ‡ë‹¤</span>
                </label>
            </div>
        </div>
        {% endfor %}

        <div class="text-center">
            <button type="submit" 
                    class="bg-blue-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:bg-blue-700 transition-colors">
                ğŸ¯ ë‹µë³€ ì œì¶œí•˜ê¸°
            </button>
        </div>
    </form>

    <div class="mt-6 text-center">
        <a href="/mbti" class="text-blue-600 hover:text-blue-800 underline">
            â† MBTI í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
        </a>
    </div>
</div>
{% endblock %} 

{% extends "base.html" %}

{% block title %}ì¹œêµ¬ MBTI í‰ê°€ - ì¹œêµ¬ ì •ë³´ ì…ë ¥{% endblock %}

{% block head %}
{{ super() }}
<style>
    .input-field:focus-visible {
        outline: 3px solid rgba(59, 130, 246, 0.65);
        outline-offset: 3px;
    }

    .info-pill {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border-radius: 9999px;
        background: rgba(255, 255, 255, 0.18);
        padding: 0.35rem 0.9rem;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
    }
</style>
{% endblock %}

{% block content %}
{% set default_friend_name = prefill_name or "ì¹œêµ¬" %}
{% set default_friend_mbti = prefill_mbti or "" %}
{% set relationship_options = [
    ("friend", "ì¹œêµ¬"),
    ("family", "ê°€ì¡±"),
    ("partner", "ë¶€ë¶€/ì»¤í”Œ"),
    ("coworker", "ì§ì¥"),
    ("other", "ê¸°íƒ€"),
] %}

<div class="mx-auto max-w-4xl space-y-10">
    <section class="rounded-3xl bg-gradient-to-br from-purple-600 via-sky-500 to-slate-900 px-6 py-10 text-white">
        <div class="space-y-6">
            <div class="flex items-center gap-4">
                {% if owner_avatar %}
                <img src="{{ owner_avatar }}" alt="{{ default_friend_name }} avatar" class="h-16 w-16 rounded-full border-4 border-white/60 object-cover shadow-lg" referrerpolicy="no-referrer">
                {% else %}
                <div class="flex h-16 w-16 items-center justify-center rounded-full border-4 border-white/60 text-2xl font-semibold shadow-lg">
                    {{ default_friend_name[:2] if default_friend_name else 'ğŸ™‚' }}
                </div>
                {% endif %}
                <div>
                    <span class="info-pill">ê´€ê³„ ì¸ì‹ ì²´í¬</span>
                    <h1 class="text-3xl md:text-4xl font-bold leading-tight">{{ default_friend_name }} ë‹˜ì— ëŒ€í•œ ì¸ì‹ ì²´í¬</h1>
                    <p class="mt-2 text-sm text-white/80">ê°€ì¥ ê°€ê¹Œìš´ ê´€ê³„ë¥¼ ê³ ë¥´ê³  1ë¶„ ë§Œì— ì‘ë‹µí•´ ì£¼ì„¸ìš”. ìµëª… ë‹‰ë„¤ì„ìœ¼ë¡œ ì°¸ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </section>

    <section class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
        <h2 class="text-xl font-semibold text-slate-900">ì§„í–‰ ìˆœì„œ</h2>
        <ol class="mt-4 space-y-3 text-sm text-slate-600">
            <li class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-indigo-600 text-xs font-bold text-white">1</span> í‘œì‹œëª…ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹‰ë„¤ì„ìœ¼ë¡œ ë°”ê¿” ì£¼ì„¸ìš”.</li>
            <li class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-indigo-600 text-xs font-bold text-white">2</span> ë‹¹ì‹ ê³¼ì˜ ê´€ê³„ë¥¼ ê³ ë¥´ê³ , ë‹‰ë„¤ì„ì„ ë‚¨ê¸°ê±°ë‚˜ ë¹„ì›Œë‘ë©´ â€˜ìµëª…â€™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.</li>
            <li class="flex items-start gap-3"><span class="mt-0.5 inline-flex h-6 w-6 items-center justify-center rounded-full bg-indigo-600 text-xs font-bold text-white">3</span> ë¬¸í•­ì€ ì•½ 1ë¶„ ì •ë„ ì†Œìš”ë¼ìš”. ì‘ë‹µ 3ëª…ì´ ëª¨ì´ë©´ {{ default_friend_name }} ë‹˜ì—ê²Œ ì¸ì‚¬ì´íŠ¸ê°€ ì—´ë¦½ë‹ˆë‹¤.</li>
        </ol>
    </section>

    <section class="rounded-3xl border border-slate-200 bg-white p-6 shadow-lg">
        <form method="POST" class="space-y-6">
            {% if invite_token %}
            <input type="hidden" name="invite_token" value="{{ invite_token }}">
            {% endif %}
            {% if prefill_name or prefill_mbti %}
            <div class="rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
                <p class="font-semibold">âœ… ì´ˆëŒ€í•œ ë¶„ì´ ë‚¨ê²¨ë‘” ì •ë³´ê°€ ë¶ˆëŸ¬ì™€ì¡Œì–´ìš”.</p>
                <ul class="mt-2 space-y-1">
                    {% if prefill_name %}<li>â€¢ í‘œì‹œëª…: {{ prefill_name }}</li>{% endif %}
                    {% if prefill_mbti %}<li>â€¢ ì°¸ê³  MBTI: {{ prefill_mbti }}</li>{% endif %}
                </ul>
            </div>
            {% endif %}

            <div>
                <label for="friend_name" class="block text-sm font-medium text-slate-700">í‰ê°€ ëŒ€ìƒ í‘œì‹œëª… *</label>
                <input id="friend_name" name="friend_name" value="{{ default_friend_name if default_friend_name != 'ì¹œêµ¬' else '' }}" required maxlength="50" class="input-field mt-2 w-full rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 shadow-sm focus-visible:ring-4 focus-visible:ring-indigo-200" placeholder="ì˜ˆ: ê¹€ì„œìœ¤">
                <p class="mt-2 text-xs text-slate-500">ì´ˆëŒ€ í˜ì´ì§€ì— ë³´ì—¬ì§€ëŠ” ì´ë¦„ì´ì—ìš”. ë³„ëª…ìœ¼ë¡œ ë°”ê¿”ë„ ì¢‹ì•„ìš”.</p>
            </div>

            <div>
                <label for="friend_mbti" class="block text-sm font-medium text-slate-700">ì‹¤ì œ MBTI (ì„ íƒ)</label>
                <input id="friend_mbti" name="friend_mbti" value="{{ default_friend_mbti }}" maxlength="4" class="input-field mt-2 w-full rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 uppercase shadow-sm focus-visible:ring-4 focus-visible:ring-indigo-200" placeholder="ì˜ˆ: INFP">
                <p class="mt-2 text-xs text-slate-500">ì•Œê³  ìˆëŠ” ê²½ìš°ì—ë§Œ ì…ë ¥í•´ ì£¼ì„¸ìš”. ì°¸ê³  ì •ë³´ë¡œë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>
            </div>

            <fieldset>
                <legend class="block text-sm font-medium text-slate-700">ë‹¹ì‹ ê³¼ì˜ ê´€ê³„ *</legend>
                <p class="mt-2 text-xs text-slate-500">ê°€ì¥ ê°€ê¹Œìš´ ê´€ê³„ë¥¼ ê³¨ë¼ ì£¼ì„¸ìš”.</p>
                <div class="mt-4 grid gap-3 sm:grid-cols-2">
                    {% for value, label in relationship_options %}
                    {% set option_id = "relationship-" ~ loop.index %}
                    <label for="{{ option_id }}" class="flex items-center gap-3 rounded-xl border border-slate-200 px-4 py-3 text-sm font-medium text-slate-700 transition hover:border-indigo-400 hover:bg-indigo-50">
                        <input id="{{ option_id }}" type="radio" name="relationship" value="{{ value }}" data-label="{{ label }}" class="h-4 w-4 text-indigo-600" required>
                        <span>{{ label }}</span>
                    </label>
                    {% endfor %}
                </div>
            </fieldset>

            <div>
                <label for="responder_name" class="block text-sm font-medium text-slate-700">ë‚´ ë‹‰ë„¤ì„ (ì„ íƒ)</label>
                <input id="responder_name" name="responder_name" maxlength="40" class="input-field mt-2 w-full rounded-xl border border-slate-200 px-4 py-3 text-base text-slate-900 shadow-sm focus-visible:ring-4 focus-visible:ring-indigo-200" placeholder="ë¹„ì›Œë‘ë©´ â€˜ìµëª…â€™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤">
                <p class="mt-2 text-xs text-slate-500">ë‚˜ì¤‘ì— ê²°ê³¼ ì¹´ë“œì—ë„ ë‹‰ë„¤ì„ì´ ìµëª…ìœ¼ë¡œ í‘œì‹œë¼ìš”.</p>
            </div>

            <button type="submit" class="w-full rounded-xl bg-gradient-to-r from-indigo-600 via-sky-500 to-emerald-500 px-6 py-3 text-base font-semibold text-white shadow-lg shadow-indigo-600/40 transition hover:-translate-y-0.5">
                ğŸ”— ì„¤ë¬¸ ì‹œì‘í•˜ê¸°
            </button>
        </form>

        <div class="mt-6 text-center">
            <a href="/mbti/" class="text-sm font-medium text-indigo-600 hover:text-indigo-700">â† MBTI í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </section>

    <section class="rounded-2xl border border-purple-200 bg-purple-50 p-6 text-sm text-purple-700">
        <h2 class="text-base font-semibold text-purple-900">ì•Œì•„ë‘ë©´ ì¢‹ì•„ìš”</h2>
        <ul class="mt-3 space-y-1">
            <li>â€¢ ë‹‰ë„¤ì„ì„ ë¹„ì›Œë‘ë©´ â€˜ìµëª…â€™ìœ¼ë¡œ ì €ì¥ë¼ìš”.</li>
            <li>â€¢ ì„¤ë¬¸ì€ ì•½ 1ë¶„ ì •ë„ ê±¸ë¦½ë‹ˆë‹¤.</li>
            <li>â€¢ ì‘ë‹µì´ 3ëª… ì´ìƒ ëª¨ì´ë©´ {{ default_friend_name }} ë‹˜ì—ê²Œ ìƒì„¸ ì¸ì‚¬ì´íŠ¸ê°€ ì—´ë¦½ë‹ˆë‹¤.</li>
        </ul>
    </section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    var friendNameInput = document.getElementById('friend_name');
    var heroTarget = document.querySelector('section h1');

    var updateHero = function (value) {
        var fallback = value && value.trim() ? value.trim() : '{{ default_friend_name|escapejs }}';
        if (heroTarget) {
            heroTarget.textContent = fallback + ' ë‹˜ì— ëŒ€í•œ ì¸ì‹ ì²´í¬';
        }
    };

    if (friendNameInput) {
        updateHero(friendNameInput.value);
        friendNameInput.addEventListener('input', function (event) {
            updateHero(event.target.value);
        });
    }

    var params = new URLSearchParams(window.location.search);
    var nameParam = params.get('name');
    var mbtiParam = params.get('mbti');
    if (nameParam && friendNameInput && !friendNameInput.value) {
        friendNameInput.value = nameParam;
        updateHero(nameParam);
    }
    var mbtiInput = document.getElementById('friend_mbti');
    if (mbtiParam && mbtiInput && !mbtiInput.value) {
        mbtiInput.value = mbtiParam;
    }
});
</script>
{% endblock %}
